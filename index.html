<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>GABWEBGL</title>
  <link rel="shortcut icon" type="image/x-icon" href="/Home/homeFavicon.ico" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", sans-serif;
    }

    body {
      height: 100vh;
      overflow: hidden;
      background: #020617;
    }

    header {
      position: absolute;
      top: 32px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    header.fade-out {
      opacity: 0;
      transform: scale(0.95);
    }

    .center-nav ul {
      list-style: none;
      display: flex;
      gap: 48px;
    }

    .center-nav a {
      position: relative;
      text-decoration: none;
      color: #e5e7eb;
      font-size: 22px;
      letter-spacing: 1px;
      padding-bottom: 8px;
      cursor: pointer;
    }

    .center-nav a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      height: 2px;
      width: 0;
      background: #6366f1;
      transition: width 0.3s ease;
    }

    .center-nav a:hover::after,
    .center-nav a.active::after {
      width: 100%;
    }

    main {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      z-index: 5;
      pointer-events: auto;
      opacity: 0;
      transition: opacity 0.6s ease;
    }

    main.visible {
      opacity: 1;
    }

    .page {
      text-align: center;
      max-width: 600px;
      line-height: 1.6;
      font-size: 20px;
    }

    canvas {
      display: block;
      pointer-events: none;
    }
  </style>
</head>
<body>

<header id="header">
  <nav class="center-nav">
    <ul>
      <li><a data-page="home" class="active">Home</a></li>
      <li><a data-page="viewer">Model viewer</a></li>
      <li><a data-page="visualizer">Music visualizer</a></li>
      <li><a data-page="tetris">Tetris</a></li>
    </ul>
  </nav>
</header>

<main id="content"></main>

<script type="module" lang="ts">
import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";

import { MusicVisualizerPlayer } from "/music_visualizer/music_visualizer.ts";

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x020617);

const camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth / window.innerHeight,
  0.1,
  100
);
camera.position.z = 4;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const mesh = new THREE.Mesh(
  new THREE.IcosahedronGeometry(1.3, 1),
  new THREE.MeshStandardMaterial({
    color: 0x6366f1, metalness: 0.6, roughness: 0.2
  })
);

const loader = new THREE.CubeTextureLoader();
const texture = loader.load([
  '/Home/NightSky_Right.png', // +X
  '/Home/NightSky_Left.png', // -X
  '/Home/NightSky_Top.png', // +Y
  '/Home/NightSky_Bottom.png', // -Y
  '/Home/NightSky_Front.png', // +Z
  '/Home/NightSky_Back.png', // -Z
]);
scene.background = texture;

scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const light = new THREE.PointLight(0xffffff, 1);
light.position.set(5, 5, 5);
scene.add(light);

async function animate()
{
  camera.position.x = Math.sin(Date.now() * 0.0001) * 4;
  camera.position.z = Math.cos(Date.now() * 0.0001) * 4;
  camera.lookAt(0, 0, 0);

  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}
animate();

const pages =
{
  home: ``,
  viewer: ``,
  visualizer: `/music_visualizer/music_visualizer.html`,
  tetris: ``
};

const content = document.getElementById("content");
const links = document.querySelectorAll("[data-page]");

async function loadPage(name) {
  content.classList.remove("visible");

  links.forEach(l => l.classList.remove("active"));
  document.querySelector(`[data-page="${name}"]`)?.classList.add("active");

  setTimeout(async () => {
    const url = pages[name];
    if (!url) return;

    try {
      const res = await fetch(url);
      const html = await res.text();
      content.innerHTML = html;
      content.classList.add("visible");
      const musicApp = new MusicVisualizerPlayer();
    } catch (err) {
      content.innerHTML = "<p>Error loading page</p>";
    }
  }, 300);
}

links.forEach(link =>
{
  link.addEventListener("click", () =>
  {
    loadPage(link.dataset.page);
  });
});

loadPage("home");
</script>

</body>
</html>
